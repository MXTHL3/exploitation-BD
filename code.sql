create table PROPRIO (
    IdP number(10),
    Nom varchar2(15),
    Prenom varchar2(15),
    constraint pk_IdP primary key(IdP));    
    
create table BIEN (
    IdEBien number(10),
    Categorie varchar2(15),
    Type_ varchar2(6),
    IdP number(10),
    Ville varchar2(45),
    Prix number(7),
    constraint pk_IdEBien primary key(IdEBien),
    constraint fk_IdP foreign key (IdP) references PROPRIO(IdP));
    
create table ESPACE (
    IdE number(10),
    Designation varchar2(50),
    Superficie number(3),
    IdERattach number(4),
    constraint pk_IdE primary key(IdE),
    constraint fk_IdERattach foreign key(IdERattach) references BIEN(IdEBien));


insert into PROPRIO values(25,'Guédès','Alexandre');
insert into PROPRIO values(29,'Jaidoux','Alexis');
insert into PROPRIO values(35,'de Boute','Maël');
insert into PROPRIO values(53,'Séjourné','Mathis');
insert into PROPRIO values(61,'Gouache','Victor');
insert into PROPRIO values(105,'Magnan','Théo');

insert into BIEN values(721,'Studio','T2',35,'Lyon',125000);
insert into BIEN values(722,'Studio','T2',35,'Lyon',123000);
insert into BIEN values(727,'Studio','T3',35,'Lyon',153000);
insert into BIEN values(723,'Studio','T2',61,'Marseille',120000);
insert into BIEN values(724,'Studio','T2',61,'Rennes',135000);
insert into BIEN values(725,'Studio','T2',29,'Lille',115000);
insert into BIEN values(726,'Studio','T2',105,'Lyon',122000);
insert into BIEN values(110,'Appartement','T4',25,'Marseille',80000);
insert into BIEN values(117,'Appartement','Studio',29,'Marseille',90000);
insert into BIEN values(171,'Appartement','T1',35,'Paris',250000);
insert into BIEN values(192,'Appartement','T1',35,'Paris',340000);
insert into BIEN values(945,'Maison de ville','T8',53,'Nice',280000);
insert into BIEN values(820,'Maison de ville','T7',25,'Nice',300000);
insert into BIEN values(830,'Maison de ville','T6',53,'Nice',200000);
insert into BIEN values(860,'Maison de ville','T7',29,'Nice',350000);
insert into BIEN values(202,'Maison de ville','T9',35,'Nice',400000);
insert into BIEN values(420,'Maison de ville','T7',53,'Nice',325000);
insert into BIEN values(430,'Maison de ville','T7',53,'Nice',335000);
insert into BIEN values(440,'Maison de ville','T7',35,'Nice',315000);
insert into BIEN values(450,'Maison de ville','T7',35,'Nice',328000);
insert into BIEN values(460,'Maison de ville','T7',53,'Nice',375000);
insert into BIEN values(470,'Maison de ville','T7',53,'Nice',325000);
insert into BIEN values(480,'Maison de ville','T8',61,'Nice',405000);
insert into BIEN values(490,'Maison de ville','T6',61,'Nice',225000);
insert into BIEN values(945,'Maison de ville','T8',29,'Paris',280000);
insert into BIEN values(822,'Maison de ville','T7',53,'Paris',300000);
insert into BIEN values(836,'Maison de ville','T6',29,'Paris',200000);
insert into BIEN values(866,'Maison de ville','T7',29,'Paris',350000);
insert into BIEN values(200,'Maison de ville','T9',61,'Paris',400000);
insert into BIEN values(101,'Maison de ville','T7',29,'Paris',325000);
insert into BIEN values(930,'Maison de ville','T7',35,'Paris',335000);
insert into BIEN values(902,'Maison de ville','T7',53,'Paris',315000);
insert into BIEN values(432,'Maison de ville','T8',105,'Paris',335000);
insert into BIEN values(443,'Maison de ville','T7',53,'Paris',305000);
insert into BIEN values(445,'Maison de ville','T8',61,'Paris',405000);
insert into BIEN values(988,'Maison de ville','T7',29,'Lyon',328000);
insert into BIEN values(970,'Maison de ville','T7',61,'Lyon',375000);
insert into BIEN values(965,'Maison de ville','T7',29,'Marseille',325000);
insert into BIEN values(966,'Maison de ville','T8',53,'Marseille',405000);
insert into BIEN values(967,'Maison de ville','T6',53,'Paris',225000);
insert into BIEN values(227,'Appartement','T3',61,'Nice',130000);
insert into BIEN values(238,'Villa','T7',105,'Nice',570000);
insert into BIEN values(239,'Villa','T7',35,'Lyon',375000);
insert into BIEN values(240,'Villa','T8',61,'Lyon',375000);
insert into BIEN values(241,'Villa','T7',105,'Lille',435000);
insert into BIEN values(242,'Villa','T9',105,'Marseille',575000);

insert into ESPACE values(1101,'Salon',15,110);
insert into ESPACE values(1104,'Cuisine',7,110);
insert into ESPACE values(1102,'Salle de bain',5,110);
insert into ESPACE values(1103,'Chambre',8,110);
insert into ESPACE values(1171,'Pièce à vivre',30,117);
insert into ESPACE values(1711,'Pièce à vivre',12,171);
insert into ESPACE values(1921,'Pièce à vivre',15,192);
insert into ESPACE values(9451,'Salon',20,945);
insert into ESPACE values(9454,'Cuisine',8,945);
insert into ESPACE values(9453,'Chambre',30,945);
insert into ESPACE values(9452,'Salle de bain',6,945);
insert into ESPACE values(2271,'Salon',10,227);
insert into ESPACE values(2273,'Chambre',20,227);
insert into ESPACE values(2272,'Salle de bain',5,227);
insert into ESPACE values(2381,'Salon',15,238);
insert into ESPACE values(2384,'Cuisine',10,238);
insert into ESPACE values(2382,'Salle de bain',10,238);
insert into ESPACE values(2383,'Chambres',25,238);
insert into ESPACE values(2385,'Terrasse',35,238);
insert into ESPACE values(2395,'Terrasse',30,239);
insert into ESPACE values(2405,'Terrasse',30,240);
insert into ESPACE values(2415,'Terrasse',40,241);
insert into ESPACE values(2425,'Terrasse',33,242);

drop table ESPACE;
drop table BIEN;
drop table PROPRIO;

--Partie 2
--q1

select count(*) Categorie,Categorie,Type_ 
from BIEN
group by Categorie, Type_;

--q2

select IdE, Designation
from ESPACE
join BIEN 
on ESPACE.IdERattach=BIEN.IdEBien
where IdERattach=945;

--q3



--q4

select Ville 
from BIEN 
where Categorie='Maison de ville' 
group by Ville 
having count(*)>10; 

--q5

select IdEBien,Prix-min(Prix) over() Prix_Ecart_Min 
from BIEN;

--q6

select IdEBien,Prix-min(Prix) over (partition by Categorie) Prix_Ecart_Min_Categ 
from BIEN;

--q7

select IdP,count(*) IdEBien
from BIEN
where Type_='Studio' 
group by IdP
having count(IdP)>=2;

--q9

select IdEBien,max(Superficie)
from BIEN
join ESPACE
on BIEN.IdEBien=ESPACE.IdERattach;

--q11

create view [Prix ecart prix minimal categorie] as
select IdEBien,Prix-min(Prix) over (partition by Categorie) Prix_Ecart_Min_Categ 
from BIEN;
